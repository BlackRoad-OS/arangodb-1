- jobProperties:
    container_suffix: '-java:'
    second_repo: git@github.com:arangodb/kafka-connect-arangodb.git
    branch: main
    init_command: ""
- add-yaml:
    derives: run-linux-tests
    derives-to: kafka-run-linux-tests
    docker:
      - image: << parameters.docker_image >>
      - image: docker.io/bitnamilegacy/kafka:3.9
        name: kafka-1
        environment:
          - BITNAMI_DEBUG: true 
          - ALLOW_PLAINTEXT_LISTENER: "yes" 
          - KAFKA_CFG_NODE_ID: 1 
          - KAFKA_CFG_PROCESS_ROLES: controller,broker 
          - KAFKA_CFG_LISTENERS: PLAINTEXT://:9092,PLAINTEXT_HOST://0.0.0.0:19092,CONTROLLER://:9093 
          - KAFKA_CFG_CONTROLLER_QUORUM_VOTERS: "1@kafka-1:9093,2@kafka-2:9093,3@kafka-3:9093" 
          - KAFKA_KRAFT_CLUSTER_ID: abcdefghijklmnopqrstuv 
          - KAFKA_CFG_CONTROLLER_LISTENER_NAMES: CONTROLLER 
          - KAFKA_CFG_ADVERTISED_LISTENERS: "PLAINTEXT://kafka-1:9092,PLAINTEXT_HOST://kafka-1:19092" 
          - KAFKA_CFG_INTER_BROKER_LISTENER_NAME: PLAINTEXT 
          - KAFKA_CFG_LISTENER_SECURITY_PROTOCOL_MAP: PLAINTEXT:PLAINTEXT,PLAINTEXT_HOST:PLAINTEXT,CONTROLLER:PLAINTEXT 
      - image: docker.io/bitnamilegacy/kafka:3.9
        name: kafka-2
        environment:
          - BITNAMI_DEBUG: true 
          - ALLOW_PLAINTEXT_LISTENER: "yes" 
          - KAFKA_CFG_NODE_ID: 2 
          - KAFKA_CFG_PROCESS_ROLES: controller,broker 
          - KAFKA_CFG_LISTENERS: PLAINTEXT://:9092,PLAINTEXT_HOST://0.0.0.0:29092,CONTROLLER://:9093 
          - KAFKA_CFG_CONTROLLER_QUORUM_VOTERS: "1@kafka-1:9093,2@kafka-2:9093,3@kafka-3:9093" 
          - KAFKA_KRAFT_CLUSTER_ID: abcdefghijklmnopqrstuv 
          - KAFKA_CFG_CONTROLLER_LISTENER_NAMES: CONTROLLER 
          - KAFKA_CFG_ADVERTISED_LISTENERS: "PLAINTEXT://kafka-2:9092,PLAINTEXT_HOST://kafka-2:29092" 
          - KAFKA_CFG_INTER_BROKER_LISTENER_NAME: PLAINTEXT 
          - KAFKA_CFG_LISTENER_SECURITY_PROTOCOL_MAP: PLAINTEXT:PLAINTEXT,PLAINTEXT_HOST:PLAINTEXT,CONTROLLER:PLAINTEXT 
      - image: docker.io/bitnamilegacy/kafka:3.9
        name: kafka-3
        environment:
          - BITNAMI_DEBUG: true 
          - ALLOW_PLAINTEXT_LISTENER: "yes" 
          - KAFKA_CFG_NODE_ID: 3 
          - KAFKA_CFG_PROCESS_ROLES: controller,broker 
          - KAFKA_CFG_LISTENERS: PLAINTEXT://:9092,PLAINTEXT_HOST://0.0.0.0:39092,CONTROLLER://:9093 
          - KAFKA_CFG_CONTROLLER_QUORUM_VOTERS: "1@kafka-1:9093,2@kafka-2:9093,3@kafka-3:9093" 
          - KAFKA_KRAFT_CLUSTER_ID: abcdefghijklmnopqrstuv 
          - KAFKA_CFG_CONTROLLER_LISTENER_NAMES: CONTROLLER 
          - KAFKA_CFG_ADVERTISED_LISTENERS: "PLAINTEXT://kafka-3:9092,PLAINTEXT_HOST://kafka-3:39092" 
          - KAFKA_CFG_INTER_BROKER_LISTENER_NAME: PLAINTEXT 
          - KAFKA_CFG_LISTENER_SECURITY_PROTOCOL_MAP: PLAINTEXT:PLAINTEXT,PLAINTEXT_HOST:PLAINTEXT,CONTROLLER:PLAINTEXT 
      - image: docker.io/confluentinc/cp-schema-registry:7.5.2
        name: kafka-schema-registry
        environment:
          - SCHEMA_REGISTRY_KAFKASTORE_BOOTSTRAP_SERVERS=PLAINTEXT://kafka-1:19092,PLAINTEXT://kafka-2:29092,PLAINTEXT://kafka-3:39092
          - SCHEMA_REGISTRY_HOST_NAME=kafka-schema-registry

- kafka_driver:
    options:
      priority: 500
      type: single
      size: large
    args:
      extremeVerbosity: true
      kafkaHost: kafka-1:19092,kafka-2:29092,kafka-3:39092
      kafkaSchemaHost: http://kafka-schema-registry:8081
- kafka_driver:
    options:
      priority: 500
      type: cluster
      size: large
    args:
      extremeVerbosity: true
      kafkaHost: kafka-1:19092,kafka-2:29092,kafka-3:39092
      kafkaSchemaHost: http://kafka-schema-registry:8081

# for the moment SSL has issues with the certificates to match the test arangod and kafka certificates.
# - kafka_driver:
#     options:
#       priority: 500
#       type: single
#       size: large
#       suffix: ssl
#     args:
#       protocol: ssl
#       extremeVerbosity: true
#       kafkaHost: kafka-1:19092,kafka-2:29092,kafka-3:39092
#       kafkaSchemaHost: http://kafka-schema-registry:8081
# - kafka_driver:
#     options:
#       priority: 500
#       type: cluster
#       size: large
#       suffix: ssl
#     args:
#       protocol: ssl
#       extremeVerbosity: true
#       kafkaHost: kafka-1:19092,kafka-2:29092,kafka-3:39092
#       kafkaSchemaHost: http://kafka-schema-registry:8081
