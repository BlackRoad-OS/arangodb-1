{"id":"armadillo-1","title":"Refactor InstanceManager to use ApplicationContext pattern","description":"Apply the same ApplicationContext dependency injection pattern to InstanceManager that was successfully applied to ArangoServer. This would eliminate remaining global state and improve testability.","design":"- Create factory methods: create_single(), create_cluster()\n- Accept ApplicationContext instead of individual dependencies  \n- Maintain backward compatibility with deprecation warnings\n- Similar to ArangoServer refactoring in Phase 2-1","acceptance_criteria":"- InstanceManager accepts ApplicationContext\n- Factory methods available\n- All existing tests pass\n- Backward compatibility maintained","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-24T13:02:33.330173188+02:00","updated_at":"2025-10-25T11:26:00.786499893+02:00","closed_at":"2025-10-25T11:26:00.786499893+02:00"}
{"id":"armadillo-10","title":"Code cleanup and polish","description":"Final cleanup pass to improve code quality: introduce value objects, centralize magic constants, fix naming consistency, and verify performance.","design":"1. Introduce value objects (reduce primitive obsession):\n   - ServerId (string with validation)\n   - Port (integer with range validation)\n   - DeploymentId (string with validation)\n   - Replace primitive types with value objects\n   - Update type hints throughout\n   \n2. Centralize magic constants:\n   - Audit for hardcoded values (timeouts, ports, paths)\n   - Move to InfrastructureConfig or appropriate config\n   - Document rationale for each value\n   \n3. Fix naming consistency:\n   - Audit _private_method usage\n   - Ensure private methods aren't called externally\n   - Standardize public API naming conventions\n   - Remove any inconsistent patterns\n   \n4. Performance testing:\n   - Benchmark refactored code vs baseline\n   - Ensure no regressions\n   - Profile hot paths\n   - Document performance characteristics","acceptance_criteria":"- Value objects introduced for key types\n- All magic constants centralized in config\n- Naming conventions consistent\n- Performance benchmarks show no regressions\n- Documentation updated\n- All tests passing","notes":"Progress - Magic Constants Eliminated:\n✅ DeploymentOrchestrator: Now uses TimeoutConfig for all operations\n✅ InstanceManager: All public methods use config-based timeouts\n✅ Dynamic timeout calculation based on actual server count (not magic 4x multiplier)\n✅ Eliminated 15+ hardcoded timeout values in critical deployment paths\n\nResults:\n- All timeouts centralized in TimeoutConfig\n- Timeouts scale dynamically with deployment size\n- Better logging shows calculated timeouts\n- All 494 tests passing\n\nRemaining (from original plan):\n- Value objects (ServerId, Port, DeploymentId)\n- Naming consistency audit  \n- Performance benchmarking\n\nCurrent status: Targeted approach successful for timeouts (most impactful).\nDecision needed: Continue with value objects/naming or consider sufficient?","status":"closed","priority":3,"issue_type":"chore","created_at":"2025-10-25T11:25:08.686707002+02:00","updated_at":"2025-10-26T11:28:50.62475364+01:00","closed_at":"2025-10-26T11:28:50.62475364+01:00"}
{"id":"armadillo-11","title":"Introduce ServerId value object to replace string primitives","description":"Replace string primitive for server_id with a proper value object to add type safety and validation.\n\nCurrently server_id is typed as `str` in ~27+ locations across instances/ module, leading to potential bugs where any string can be passed.\n\nA ServerId value object would:\n- Prevent empty/invalid server IDs\n- Make the domain model more explicit\n- Catch errors at construction time rather than runtime\n- Self-document the code","design":"1. Create armadillo/core/value_objects.py with ServerId class\n2. Update type hints in instances/server.py, manager.py, server_registry.py, deployment_planner.py (~27 locations total)\n3. Update factory methods to construct ServerId objects\n4. Update comparison logic: `server_id == \"foo\"` → `server_id.value == \"foo\"`\n5. Update all tests to use ServerId constructor\n\nImplementation notes:\n- ServerId validates non-empty alphanumeric identifiers\n- Implements __eq__, __hash__ for use in dicts/sets\n- Provides .value property for string access","acceptance_criteria":"- ServerId class implemented with validation\n- All type hints updated from `str` to `ServerId`\n- All construction sites create ServerId objects\n- All comparison logic updated\n- All tests passing\n- No string primitives used for server identifiers","status":"open","priority":4,"issue_type":"chore","created_at":"2025-10-26T11:29:02.64005518+01:00","updated_at":"2025-10-26T11:29:02.64005518+01:00"}
{"id":"armadillo-12","title":"Introduce Port value object to replace int primitives","description":"Replace integer primitive for ports with a proper value object to add validation and prevent invalid port numbers.\n\nCurrently port is typed as `int` in ~13+ locations, allowing any integer including invalid port numbers (\u003c 1024 or \u003e 65535).\n\nA Port value object would:\n- Enforce valid port range (1024-65535)\n- Prevent privileged ports (\u003c 1024) from being used accidentally\n- Make port allocation logic more explicit\n- Catch invalid ports at construction time","design":"1. Create Port class in armadillo/core/value_objects.py\n2. Update type hints in instances/server.py, utils/ports.py, deployment_plan.py, core/types.py (~13 locations)\n3. Update PortManager/PortAllocator to return Port objects\n4. Update all port arithmetic: `port + 1` → `Port(port.value + 1)`\n5. Update command builders and server configs to use port.value\n6. Update all tests\n\nImplementation notes:\n- Port validates range 1024-65535\n- Implements __int__, __eq__, __hash__\n- Provides .value property for int access","acceptance_criteria":"- Port class implemented with range validation\n- All type hints updated from `int` to `Port`\n- PortManager returns Port objects\n- All port construction validated\n- All tests passing\n- No raw integers used for ports","status":"open","priority":4,"issue_type":"chore","created_at":"2025-10-26T11:29:06.094969191+01:00","updated_at":"2025-10-26T11:29:06.094969191+01:00"}
{"id":"armadillo-13","title":"Introduce DeploymentId value object to replace string primitives","description":"Replace string primitive for deployment_id with a proper value object for type safety and validation.\n\nCurrently deployment_id is typed as `str` in multiple locations across instances/ and pytest_plugin/, allowing any string to be used as a deployment identifier.\n\nA DeploymentId value object would:\n- Ensure valid identifier format\n- Prevent confusion with server_id\n- Make deployment tracking more explicit\n- Add validation at construction time","design":"1. Create DeploymentId class in armadillo/core/value_objects.py\n2. Update type hints in instances/manager.py, orchestrator.py, pytest_plugin/plugin.py\n3. Update factory methods and constructors\n4. Update registry/lookup logic\n5. Update all tests\n\nImplementation notes:\n- DeploymentId validates non-empty alphanumeric identifiers\n- Implements __eq__, __hash__ for use in registries\n- Provides .value property for string access","acceptance_criteria":"- DeploymentId class implemented with validation\n- All type hints updated from `str` to `DeploymentId`\n- All construction sites validated\n- All registry/lookup logic updated\n- All tests passing\n- No string primitives used for deployment identifiers","status":"open","priority":4,"issue_type":"chore","created_at":"2025-10-26T11:29:09.04921488+01:00","updated_at":"2025-10-26T11:29:09.04921488+01:00"}
{"id":"armadillo-14","title":"Naming consistency audit and cleanup","description":"Perform final pass to ensure naming conventions are consistent across the codebase.\n\nAudit for:\n- Private methods (_method) that should be public or vice versa\n- Inconsistent naming patterns (get_ vs fetch_, check_ vs verify_)\n- Parameter names that signal intent incorrectly (e.g., _timeout suggesting unused)\n- Methods that violate single responsibility in their naming\n- Public APIs that expose implementation details","design":"1. Systematic audit by module: core/*, instances/*, pytest_plugin/*, utils/*\n2. Document naming conventions in NAMING_CONVENTIONS.md:\n   - When to use get_ vs fetch_ (get = sync lookup, fetch = may involve I/O)\n   - When to use check_ vs verify_ (check = boolean return, verify = raises on failure)\n   - When methods should be private (internal helpers, not part of public API)\n   - Parameter naming (leading underscore only when actually unused)\n3. Create naming consistency guide document\n4. Refactor any violations found\n5. Consider creating linter rules for common patterns","acceptance_criteria":"- Naming conventions documented\n- All inconsistencies identified and catalogued\n- Critical violations fixed\n- Public API naming is consistent and intuitive\n- Private methods are appropriately scoped\n- All tests passing","status":"open","priority":4,"issue_type":"chore","created_at":"2025-10-26T11:29:12.191103546+01:00","updated_at":"2025-10-26T11:29:12.191103546+01:00"}
{"id":"armadillo-15","title":"Align Armadillo docs with current implementation (README + implementation_plan)","description":"Update tests/python/armadillo/README.md and tests/python/plan/implementation_plan.md to reflect the actual implemented features and current CLI/pytest plugin behavior.\n\nScope:\n- README: expand markers list to actual implemented markers; clarify cluster support status (available), adjust troubleshooting (remove ports.txt), list supported env vars (ARMADILLO_LOG_LEVEL, ARMADILLO_SHOW_SERVER_LOGS, ARMADILLO_COMPACT_MODE, ARMADILLO_KEEP_INSTANCES_ON_FAILURE), confirm CLI subcommands (armadillo test run ...; analyze summary ...), and note current result formats (JSON + JUnit).\n- implementation_plan: mark Phase 1 \u0026 Phase 2 core deliverables as implemented; update CLI design to current subcommands; update dependencies to match pyproject (add pyjwt, python-arango, requests, pydantic-settings); adjust fixture examples to sync (not async); clarify that advanced monitoring/analyzers (HTML/YAML exporters, crash analyzer, GDB, net/mem profiling) are future phases.\n- Cross-check PLUGIN_ARCHITECTURE.md for consistency with plugin behavior (safety net cleanup, compact mode).\n\nAcceptance:\n- Docs accurately describe implemented features and limitations\n- Examples runnable against current CLI\n- No stale instructions (e.g., ports.txt)\n- Links and paths correct","notes":"Audited implementation vs docs and identified mismatches. Will propose concrete edits next for approval before editing files.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-27T19:12:00.811220889+01:00","updated_at":"2025-10-28T12:20:59.803948249+01:00","closed_at":"2025-10-28T12:20:59.803948249+01:00","labels":["armadillo","docs"]}
{"id":"armadillo-16","title":"Add pytest-timeout as runtime dependency","description":"Add pytest-timeout to pyproject.toml dependencies to enable per-test timeout enforcement via SIGALRM on Linux.\n\nChanges:\n- pyproject.toml: add pytest-timeout~=2.2 to dependencies\n- Verify it works with current pytest version\n- Document in README that per-test timeouts use signal mode (Linux-only, interrupts blocking I/O)","status":"open","priority":1,"issue_type":"task","created_at":"2025-10-28T14:17:50.383864841+01:00","updated_at":"2025-10-28T14:17:50.383864841+01:00"}
{"id":"armadillo-17","title":"CLI: add --global-timeout flag and map to ArmadilloConfig.test_timeout","description":"Introduce --global-timeout CLI flag to set the entire test session deadline (currently hard-coded 900s default in ArmadilloConfig).\n\nChanges:\n- armadillo/cli/commands/test.py: add global_timeout field to TestRunOptions\n- Pass global_timeout to ArmadilloConfig constructor as test_timeout\n- Update help text to clarify: --timeout is per-test, --global-timeout is for entire session\n- Update README with both flags and their defaults","status":"open","priority":1,"issue_type":"feature","created_at":"2025-10-28T14:17:55.065938821+01:00","updated_at":"2025-10-28T14:17:55.065938821+01:00","dependencies":[{"issue_id":"armadillo-17","depends_on_id":"armadillo-16","type":"blocks","created_at":"2025-10-28T14:17:55.079414794+01:00","created_by":"daemon"}]}
{"id":"armadillo-18","title":"Implement output-idle timeout for pytest subprocess","description":"Add --output-idle-timeout flag to kill pytest if it produces no stdout/stderr for N seconds (detect hung tests that neither timeout nor fail).\n\nDesign:\n- CLI: add output_idle_timeout field (default: None = disabled)\n- armadillo/cli/commands/test.py: instead of subprocess.run, use Popen with line-by-line tee + idle tracking\n- Track last_output_time; if time.monotonic() - last_output_time \u003e threshold, escalate: SIGTERM, wait 5s, SIGKILL\n- Log clear message when idle timeout triggers\n- Update README with flag and recommended value (e.g., 300s for CI)\n\nConstraints:\n- Must not buffer output (line-buffered tee)\n- Must not interfere with user-visible output formatting","status":"open","priority":1,"issue_type":"feature","created_at":"2025-10-28T14:18:00.560320187+01:00","updated_at":"2025-10-28T14:18:00.560320187+01:00","dependencies":[{"issue_id":"armadillo-18","depends_on_id":"armadillo-17","type":"blocks","created_at":"2025-10-28T14:18:00.574223136+01:00","created_by":"daemon"}]}
{"id":"armadillo-19","title":"Add integration tests for all three timeout modes","description":"Write framework tests to verify timeout enforcement works correctly for per-test, global, and output-idle timeouts.\n\nTest cases:\n- Per-test timeout: test that sleeps longer than --timeout is killed with pytest-timeout traceback\n- Global timeout: long test suite exceeding --global-timeout triggers ArmadilloConfig.test_timeout enforcement\n- Output-idle timeout: test that hangs without output for longer than --output-idle-timeout is terminated\n- No false positives: tests that finish cleanly within all thresholds pass\n\nLocation: framework_tests/integration/test_timeouts.py","status":"open","priority":2,"issue_type":"task","created_at":"2025-10-28T14:18:05.696439941+01:00","updated_at":"2025-10-28T14:18:05.696439941+01:00","dependencies":[{"issue_id":"armadillo-19","depends_on_id":"armadillo-18","type":"blocks","created_at":"2025-10-28T14:18:05.709716009+01:00","created_by":"daemon"}]}
{"id":"armadillo-2","title":"Remove ServerDependencies and ManagerDependencies wrapper classes","description":"After refactoring both ArangoServer and InstanceManager to use ApplicationContext, the ServerDependencies and ManagerDependencies wrapper classes are no longer needed and can be removed. This will simplify the codebase.","design":"- Remove ServerDependencies dataclass from instances/server.py\n- Remove ManagerDependencies dataclass from instances/manager.py\n- Update any remaining references\n- Clean up imports","acceptance_criteria":"- Both wrapper classes removed\n- No test failures\n- Code is cleaner and simpler","status":"closed","priority":3,"issue_type":"chore","created_at":"2025-10-24T13:02:44.480484412+02:00","updated_at":"2025-10-25T11:26:01.81412455+02:00","closed_at":"2025-10-25T11:26:01.81412455+02:00","dependencies":[{"issue_id":"armadillo-2","depends_on_id":"armadillo-1","type":"blocks","created_at":"2025-10-24T13:02:44.485013532+02:00","created_by":"daemon"}]}
{"id":"armadillo-20","title":"Document timeout behavior and best practices in README","description":"Add a \"Timeouts\" section to README explaining all three timeout modes, when to use each, and recommended values.\n\nContent:\n- Per-test (--timeout): default off; kills individual hung tests via SIGALRM (Linux)\n- Global (--global-timeout): default 900s; kills entire session if exceeded\n- Output-idle (--output-idle-timeout): default off; kills pytest if no output for N seconds\n- Recommended CI settings: --timeout 120 --global-timeout 1800 --output-idle-timeout 300\n- Trade-offs: aggressive timeouts may kill slow but legitimate tests on loaded CI runners","status":"open","priority":2,"issue_type":"task","created_at":"2025-10-28T14:18:09.321888887+01:00","updated_at":"2025-10-28T14:18:09.321888887+01:00","dependencies":[{"issue_id":"armadillo-20","depends_on_id":"armadillo-19","type":"blocks","created_at":"2025-10-28T14:18:09.33486858+01:00","created_by":"daemon"}]}
{"id":"armadillo-3","title":"Update all InstanceManager creation call sites to use factory methods","description":"After refactoring InstanceManager to use ApplicationContext, update all call sites throughout the codebase to use the new factory methods instead of direct instantiation.","design":"- Find all InstanceManager() instantiations\n- Replace with factory method calls\n- Update tests to use ApplicationContext.for_testing()\n- Verify all tests pass","acceptance_criteria":"- All call sites updated\n- Tests using ApplicationContext.for_testing()\n- No deprecation warnings in new code\n- All tests passing","status":"closed","priority":3,"issue_type":"task","created_at":"2025-10-24T13:02:53.150409593+02:00","updated_at":"2025-10-25T11:26:02.86730656+02:00","closed_at":"2025-10-25T11:26:02.86730656+02:00","dependencies":[{"issue_id":"armadillo-3","depends_on_id":"armadillo-1","type":"blocks","created_at":"2025-10-24T13:02:53.163651939+02:00","created_by":"daemon"}]}
{"id":"armadillo-4","title":"Eliminate circular imports by removing TYPE_CHECKING pattern","description":"Remove TYPE_CHECKING workaround by fixing the root cause of circular dependencies through proper module layering. Separate pure utilities from stateful services in FilesystemService.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-10-24T13:03:02.749927109+02:00","updated_at":"2025-10-24T13:03:10.400456451+02:00","closed_at":"2025-10-24T13:03:10.400456451+02:00"}
{"id":"armadillo-5","title":"Refactor ArangoServer to use ApplicationContext pattern","description":"Refactor ArangoServer to use clean dependency injection via ApplicationContext. Add factory methods, maintain backward compatibility, update tests and supporting classes.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-10-24T13:03:17.463688327+02:00","updated_at":"2025-10-24T13:03:25.52620532+02:00","closed_at":"2025-10-24T13:03:25.52620532+02:00"}
{"id":"armadillo-6","title":"Test MCP integration","description":"Testing that bd MCP tools work correctly after environment variable configuration","status":"closed","priority":4,"issue_type":"task","created_at":"2025-10-24T13:35:34.414415135+02:00","updated_at":"2025-10-24T13:35:43.746230127+02:00","closed_at":"2025-10-24T13:35:43.746230127+02:00"}
{"id":"armadillo-7","title":"Remove all backward compatibility code and clean up architecture","description":"This is NEW code with no external users. Remove all backward compatibility shims, deprecated code paths, and clean up the architecture to only support the new ApplicationContext pattern.","design":"- Remove ServerDependencies and ManagerDependencies classes entirely\n- Clean ArangoServer constructor to ONLY accept new pattern (server_id, role, port, paths, app_context)\n- Remove _init_backward_compat method\n- Remove all deprecation warnings\n- Update ALL test files to use factory methods\n- Remove all 'backward compatibility' comments\n- Clean up InstanceManager similarly","acceptance_criteria":"- No ServerDependencies/ManagerDependencies classes exist\n- Constructor is clean and simple\n- All tests using factory methods\n- No deprecation warnings anywhere\n- All tests passing","notes":"Completed and fixed: All backward compatibility removed, production usage working, all 494 tests passing.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-10-24T13:43:15.206650956+02:00","updated_at":"2025-10-24T18:50:23.285821946+02:00","closed_at":"2025-10-24T14:13:46.151774319+02:00"}
{"id":"armadillo-8","title":"Standardize error handling patterns","description":"Establish and enforce consistent error handling patterns across the codebase. Currently error handling is inconsistent with bare except clauses, silent swallowing, and missing context preservation.","design":"1. Create error handling guidelines document (core/error_handling.py)\n   - Library code: let errors propagate with context\n   - Boundary code: catch and convert to user messages\n   - Never catch Exception - always be specific\n   - Always use 'from e' when re-raising\n   \n2. Systematic audit and fixes:\n   - Search for 'except Exception' → replace with specific exceptions\n   - Search for 'except: pass' → add logging or justification\n   - Search for 'raise ... Exception' → ensure 'from e' is used\n   - Convert cleanup code to context managers where appropriate\n   \n3. Priority files to audit:\n   - core/process.py (process lifecycle errors)\n   - instances/server.py (server lifecycle errors)\n   - instances/manager.py (deployment errors)\n   - pytest_plugin/plugin.py (boundary error handling)\n   \n4. Create CLI error handling decorator for consistent boundary handling","acceptance_criteria":"- Error handling guidelines documented\n- Zero bare 'except:' clauses\n- Zero 'except Exception' in library code\n- All re-raises use 'from e'\n- CLI boundary uses consistent error handling\n- All tests passing","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-25T11:24:42.929332851+02:00","updated_at":"2025-10-25T14:53:45.328211986+02:00","closed_at":"2025-10-25T14:53:45.328211986+02:00"}
{"id":"armadillo-9","title":"Establish consistent async/sync patterns","description":"Codebase has mixed sync/async patterns causing confusion and potential performance issues. Need to choose one paradigm and apply consistently, with explicit adapters where needed.","design":"Decision: Go full async where appropriate (I/O-bound operations)\n\n1. Audit sync/async boundary:\n   - Mark each module as Pure Async, Pure Sync, or Mixed\n   - Identify which modules need conversion\n   \n2. Convert core classes to async:\n   - instances/server.py (start, stop, health checks)\n   - instances/manager.py (deployment operations)\n   - instances/health_checker.py (all checks)\n   \n3. Create sync adapters module:\n   - sync_adapters.py with explicit sync wrappers\n   - Document when/why to use each adapter\n   - Warning about event loop creation costs\n   \n4. Update tests:\n   - Use @pytest.mark.asyncio for async tests\n   - Update fixtures to support async\n   - Document async testing patterns\n   \n5. Keep pure computation sync (utils, validation, etc.)","acceptance_criteria":"- Clear async/sync boundary documented\n- Core I/O operations are async\n- Sync adapters isolated in one module\n- Tests updated to use async patterns\n- No asyncio.run() in class methods\n- All tests passing","notes":"DEFERRED - Complex pytest-asyncio integration issues\n\nInvestigation findings (Oct 27, 2025):\n\n**Test Integration Problem:**\nWhen converting tests to @pytest.mark.asyncio with async/await:\n- Individual async tests PASS when run alone\n- Multiple async tests together FAIL during pytest-asyncio setup\n- Error: PermissionError: [Errno 1] Operation not permitted (in selectors.py during event loop creation)\n- Also: AttributeError: '_UnixSelectorEventLoop' object has no attribute '_signal_handlers' (during cleanup)\n\n**Environment:**\n- Python 3.13.3\n- pytest-asyncio 1.1.0\n- WSL2\n- ulimit -n: 1048576 (NOT resource exhaustion)\n\n**What Was Tried:**\n1. asyncio.run() in sync tests - caused event loop conflicts\n2. Creating server instances in async test context - event loop cleanup errors\n3. Module-scoped event loops - not fully tested\n4. Reverting to sync tests - still got setup errors\n\n**Root Cause:**\nUNKNOWN. The interaction between pytest-asyncio, Python 3.13, test class fixtures (setup_method), and event loop management is complex.\n\n**Decision:**\nAsync conversion work has been rolled back (git reset to 634470b1ebb).\nCurrent synchronous approach works perfectly: 494 tests passing, 2 skipped.\n\n**To Revisit:**\n- Investigate pytest-asyncio event loop management in depth\n- Consider alternative testing approaches\n- Check if Python 3.14 or newer pytest-asyncio versions resolve the issue\n- May need to restructure test classes to avoid setup_method with async tests","status":"open","priority":3,"issue_type":"task","created_at":"2025-10-25T11:24:56.748859382+02:00","updated_at":"2025-10-27T14:19:35.244487531+01:00"}
