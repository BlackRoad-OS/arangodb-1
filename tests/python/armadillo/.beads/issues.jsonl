{"id":"armadillo-1","title":"Refactor InstanceManager to use ApplicationContext pattern","description":"Apply the same ApplicationContext dependency injection pattern to InstanceManager that was successfully applied to ArangoServer. This would eliminate remaining global state and improve testability.","design":"- Create factory methods: create_single(), create_cluster()\n- Accept ApplicationContext instead of individual dependencies  \n- Maintain backward compatibility with deprecation warnings\n- Similar to ArangoServer refactoring in Phase 2-1","acceptance_criteria":"- InstanceManager accepts ApplicationContext\n- Factory methods available\n- All existing tests pass\n- Backward compatibility maintained","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-24T13:02:33.330173188+02:00","updated_at":"2025-10-25T11:26:00.786499893+02:00","closed_at":"2025-10-25T11:26:00.786499893+02:00"}
{"id":"armadillo-10","title":"Code cleanup and polish","description":"Final cleanup pass to improve code quality: introduce value objects, centralize magic constants, fix naming consistency, and verify performance.","design":"1. Introduce value objects (reduce primitive obsession):\n   - ServerId (string with validation)\n   - Port (integer with range validation)\n   - DeploymentId (string with validation)\n   - Replace primitive types with value objects\n   - Update type hints throughout\n   \n2. Centralize magic constants:\n   - Audit for hardcoded values (timeouts, ports, paths)\n   - Move to InfrastructureConfig or appropriate config\n   - Document rationale for each value\n   \n3. Fix naming consistency:\n   - Audit _private_method usage\n   - Ensure private methods aren't called externally\n   - Standardize public API naming conventions\n   - Remove any inconsistent patterns\n   \n4. Performance testing:\n   - Benchmark refactored code vs baseline\n   - Ensure no regressions\n   - Profile hot paths\n   - Document performance characteristics","acceptance_criteria":"- Value objects introduced for key types\n- All magic constants centralized in config\n- Naming conventions consistent\n- Performance benchmarks show no regressions\n- Documentation updated\n- All tests passing","notes":"Progress - Magic Constants Eliminated:\n✅ DeploymentOrchestrator: Now uses TimeoutConfig for all operations\n✅ InstanceManager: All public methods use config-based timeouts\n✅ Dynamic timeout calculation based on actual server count (not magic 4x multiplier)\n✅ Eliminated 15+ hardcoded timeout values in critical deployment paths\n\nResults:\n- All timeouts centralized in TimeoutConfig\n- Timeouts scale dynamically with deployment size\n- Better logging shows calculated timeouts\n- All 494 tests passing\n\nRemaining (from original plan):\n- Value objects (ServerId, Port, DeploymentId)\n- Naming consistency audit  \n- Performance benchmarking\n\nCurrent status: Targeted approach successful for timeouts (most impactful).\nDecision needed: Continue with value objects/naming or consider sufficient?","status":"in_progress","priority":3,"issue_type":"chore","created_at":"2025-10-25T11:25:08.686707002+02:00","updated_at":"2025-10-25T19:06:43.947294551+02:00"}
{"id":"armadillo-2","title":"Remove ServerDependencies and ManagerDependencies wrapper classes","description":"After refactoring both ArangoServer and InstanceManager to use ApplicationContext, the ServerDependencies and ManagerDependencies wrapper classes are no longer needed and can be removed. This will simplify the codebase.","design":"- Remove ServerDependencies dataclass from instances/server.py\n- Remove ManagerDependencies dataclass from instances/manager.py\n- Update any remaining references\n- Clean up imports","acceptance_criteria":"- Both wrapper classes removed\n- No test failures\n- Code is cleaner and simpler","status":"closed","priority":3,"issue_type":"chore","created_at":"2025-10-24T13:02:44.480484412+02:00","updated_at":"2025-10-25T11:26:01.81412455+02:00","closed_at":"2025-10-25T11:26:01.81412455+02:00","dependencies":[{"issue_id":"armadillo-2","depends_on_id":"armadillo-1","type":"blocks","created_at":"2025-10-24T13:02:44.485013532+02:00","created_by":"daemon"}]}
{"id":"armadillo-3","title":"Update all InstanceManager creation call sites to use factory methods","description":"After refactoring InstanceManager to use ApplicationContext, update all call sites throughout the codebase to use the new factory methods instead of direct instantiation.","design":"- Find all InstanceManager() instantiations\n- Replace with factory method calls\n- Update tests to use ApplicationContext.for_testing()\n- Verify all tests pass","acceptance_criteria":"- All call sites updated\n- Tests using ApplicationContext.for_testing()\n- No deprecation warnings in new code\n- All tests passing","status":"closed","priority":3,"issue_type":"task","created_at":"2025-10-24T13:02:53.150409593+02:00","updated_at":"2025-10-25T11:26:02.86730656+02:00","closed_at":"2025-10-25T11:26:02.86730656+02:00","dependencies":[{"issue_id":"armadillo-3","depends_on_id":"armadillo-1","type":"blocks","created_at":"2025-10-24T13:02:53.163651939+02:00","created_by":"daemon"}]}
{"id":"armadillo-4","title":"Eliminate circular imports by removing TYPE_CHECKING pattern","description":"Remove TYPE_CHECKING workaround by fixing the root cause of circular dependencies through proper module layering. Separate pure utilities from stateful services in FilesystemService.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-10-24T13:03:02.749927109+02:00","updated_at":"2025-10-24T13:03:10.400456451+02:00","closed_at":"2025-10-24T13:03:10.400456451+02:00"}
{"id":"armadillo-5","title":"Refactor ArangoServer to use ApplicationContext pattern","description":"Refactor ArangoServer to use clean dependency injection via ApplicationContext. Add factory methods, maintain backward compatibility, update tests and supporting classes.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-10-24T13:03:17.463688327+02:00","updated_at":"2025-10-24T13:03:25.52620532+02:00","closed_at":"2025-10-24T13:03:25.52620532+02:00"}
{"id":"armadillo-6","title":"Test MCP integration","description":"Testing that bd MCP tools work correctly after environment variable configuration","status":"closed","priority":4,"issue_type":"task","created_at":"2025-10-24T13:35:34.414415135+02:00","updated_at":"2025-10-24T13:35:43.746230127+02:00","closed_at":"2025-10-24T13:35:43.746230127+02:00"}
{"id":"armadillo-7","title":"Remove all backward compatibility code and clean up architecture","description":"This is NEW code with no external users. Remove all backward compatibility shims, deprecated code paths, and clean up the architecture to only support the new ApplicationContext pattern.","design":"- Remove ServerDependencies and ManagerDependencies classes entirely\n- Clean ArangoServer constructor to ONLY accept new pattern (server_id, role, port, paths, app_context)\n- Remove _init_backward_compat method\n- Remove all deprecation warnings\n- Update ALL test files to use factory methods\n- Remove all 'backward compatibility' comments\n- Clean up InstanceManager similarly","acceptance_criteria":"- No ServerDependencies/ManagerDependencies classes exist\n- Constructor is clean and simple\n- All tests using factory methods\n- No deprecation warnings anywhere\n- All tests passing","notes":"Completed and fixed: All backward compatibility removed, production usage working, all 494 tests passing.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-10-24T13:43:15.206650956+02:00","updated_at":"2025-10-24T18:50:23.285821946+02:00","closed_at":"2025-10-24T14:13:46.151774319+02:00"}
{"id":"armadillo-8","title":"Standardize error handling patterns","description":"Establish and enforce consistent error handling patterns across the codebase. Currently error handling is inconsistent with bare except clauses, silent swallowing, and missing context preservation.","design":"1. Create error handling guidelines document (core/error_handling.py)\n   - Library code: let errors propagate with context\n   - Boundary code: catch and convert to user messages\n   - Never catch Exception - always be specific\n   - Always use 'from e' when re-raising\n   \n2. Systematic audit and fixes:\n   - Search for 'except Exception' → replace with specific exceptions\n   - Search for 'except: pass' → add logging or justification\n   - Search for 'raise ... Exception' → ensure 'from e' is used\n   - Convert cleanup code to context managers where appropriate\n   \n3. Priority files to audit:\n   - core/process.py (process lifecycle errors)\n   - instances/server.py (server lifecycle errors)\n   - instances/manager.py (deployment errors)\n   - pytest_plugin/plugin.py (boundary error handling)\n   \n4. Create CLI error handling decorator for consistent boundary handling","acceptance_criteria":"- Error handling guidelines documented\n- Zero bare 'except:' clauses\n- Zero 'except Exception' in library code\n- All re-raises use 'from e'\n- CLI boundary uses consistent error handling\n- All tests passing","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-25T11:24:42.929332851+02:00","updated_at":"2025-10-25T14:53:45.328211986+02:00","closed_at":"2025-10-25T14:53:45.328211986+02:00"}
{"id":"armadillo-9","title":"Establish consistent async/sync patterns","description":"Codebase has mixed sync/async patterns causing confusion and potential performance issues. Need to choose one paradigm and apply consistently, with explicit adapters where needed.","design":"Decision: Go full async where appropriate (I/O-bound operations)\n\n1. Audit sync/async boundary:\n   - Mark each module as Pure Async, Pure Sync, or Mixed\n   - Identify which modules need conversion\n   \n2. Convert core classes to async:\n   - instances/server.py (start, stop, health checks)\n   - instances/manager.py (deployment operations)\n   - instances/health_checker.py (all checks)\n   \n3. Create sync adapters module:\n   - sync_adapters.py with explicit sync wrappers\n   - Document when/why to use each adapter\n   - Warning about event loop creation costs\n   \n4. Update tests:\n   - Use @pytest.mark.asyncio for async tests\n   - Update fixtures to support async\n   - Document async testing patterns\n   \n5. Keep pure computation sync (utils, validation, etc.)","acceptance_criteria":"- Clear async/sync boundary documented\n- Core I/O operations are async\n- Sync adapters isolated in one module\n- Tests updated to use async patterns\n- No asyncio.run() in class methods\n- All tests passing","status":"open","priority":3,"issue_type":"task","created_at":"2025-10-25T11:24:56.748859382+02:00","updated_at":"2025-10-25T11:24:56.748859382+02:00"}
